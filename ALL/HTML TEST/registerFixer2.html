<!DOCTYPE html>
<html>
<head>
    <title>Contact Form</title>
</head>
<body>
    <h1>Contact Us</h1>
    <form id="contactForm">
        <label for="name">Name:</label>
        <input type="text" id="Name" name="name" required><br><br>
        
        <label for="tel">Telephone:</label>
        <input type="text" id="Tel" name="tel" required><br><br>
        
        <input type="submit" id="button" onclick="submitForm()" value="Submit">
    </form>
    <div id="success" style="display:none">
        <h4 >
        <center> บันทึกข้อมูลเรียบร้อย! </center>
        </h4>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
    <script>
        function showSuccess(e) {
            if (e === "OK") {
                $('#contactForm').hide();
                $('#success').show();
                // setTimeout(function () {
                // window.close(); // Close the site after a delay
                // }, 3000); 

            } else {
                showError(e);
                // setTimeout(function () {
                // window.close(); // Close the site after a delay
                // }, 3000); 
            }
        }

        function showError(e) {
            Swal.fire({
                title: 'คุณกรอกข้อมูลยังไม่ครบ!',
                text: e,
                icon: 'error',
                confirmButtonText: 'ตกลง'
            })
        }

        function submitForm() {
            document.getElementById("button").style.display = "none"
            //showMessage("...ระบบกำลังบันทึกข้อมูล...");
            let userId = '<?= userId ?>';
            let pictureUrl = '<?= pictureUrl ?>';
            const jsonData = {}
              jsonData.Name = $('input#Name').val()
              jsonData.UserId = userId
              jsonData.Tel = $('input#Tel').val()
              jsonData.Problem = []
            //console.log(JSON.stringify(jsonData));
            /*google.script.run.withSuccessHandler(function (result) {
                console.log(result)
                /*if (result.status === "OK" && result.dup === "no") {
                    showSuccess(); // Show success and close after a delay
                } else if (result.status === "OK" && result.dup === "dup"){
                    showError("คุณและคุณเท่านั้น");
                } else {
                    showError(result.status);
                }
            }).insertFixer(JSON.stringify(jsonData)); */
            console.log("Calling insertFixer with data: " + JSON.stringify(jsonData));
            google.script.run.withSuccessHandler(function (result) {
              console.log(result.status);
              /*if (result.status === "OK" && result.dup === "no") {
                  showSuccess(); // ตรวจสอบว่าฟังก์ชัน showSuccess() ถูกเรียกตรงนี้หรือไม่
              } else if (result.status === "OK" && result.dup === "dup"){
                  showError("คุณและคุณเท่านั้น");
              } else {
                  showError(result.status); // ตรวจสอบว่าฟังก์ชัน showError() ถูกเรียกตรงนี้หรือไม่
              }*/
          }).insertFixer(JSON.stringify(jsonData));
        }

        function showMessage(e) {
            Swal.fire({
                title: '...กรุณารอสักครู...',
                text: '...ระบบกำลังบันทึกข้อมูล...',
                showConfirmButton: false,
                timer: 10000
            })
        }

        
    </script>
</body>
</html>
